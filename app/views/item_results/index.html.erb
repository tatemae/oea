<% content_for :page_title do -%>
  Item Results for <%= @title %>
<% end -%>

<% if @summary -%>
<div class="results_container">
  <div class="container">
    <div class="row">
      <div class="col-sm-10 col-sm-offset-1">
        <div class="well">
          <h2>Item Results for <%= @item_results_summary[:identifier] %> <small class="pull-right"><%= link_to 'Raw Results', item_results_path(identifier: @item_results_summary[:identifier]) %></small></h2>
          <table class="table">
            <tbody>
              <tr>
                <th>Number of Times Displayed</th>
                <td><%= @item_results_summary[:number_renders] %></td>
              </tr>
              <tr>
                <th>Number of Unique Users</th>
                <td><%= @item_results_summary[:number_of_users] %></td>
              </tr>
              <tr>
                <th>Number of Submissions</th>
                <td><%= @item_results_summary[:number_submitted] %></td>
              </tr>
              <tr>
                <th>Average Score</th>
                <td><%= signif(@item_results_summary[:percent_correct], 2) %>%</td>
              </tr>
              <tr>
                <th>Number of Referers</th>
                <td><%= @item_results_summary[:number_referers] %></td>
              </tr>
              <tr>
                <th>Average Time Spent Completing Assessment</th>
                <td><%= distance_of_time_in_words( @avg_time_to_complete ) %></td>
              </tr>
              <tr>
                <th>Average Confidence</th>
                <td><%= @avg_confidence %></td>
              </tr>
              <tr>
                <th>CSV Download</th>
                <td><a href="<%= item_results_path(identifier: @item_results_summary[:identifier], format: :csv, type: "summary") %>"><i class="glyphicon glyphicon-download"></i></a></td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>
  </div>
</div>
<% else -%>
  <div class="item_results_table">
    <h2>
      Item Results for <%= @title %> 
      <small class="pull-right"><%= link_to 'Summary', item_results_path(params.merge(type: :summary)) %></small>
    </h2>
    <h2>
      <a href="<%= item_results_path(params.merge(format: :csv)) %>">
        <small><i class='glyphicon glyphicon-download'></i> CSV</small>
      </a>
    </h2>
    <table class="table table-striped table-bordered" id="item_results">
      <thead>
        <tr>
          <th>Identifier</th>
          <th>Sequence Index</th>
          <th>Datestamp</th>
          <th>Session Status</th>
          <th>Item Variable</th>
          <th>Candidate Comment</th>
          <th>Rendered Datestamp</th>
          <th>Referer</th>
          <th>Ip Address</th>
          <th>Item Id</th>
          <th>User Id</th>
          <th>Created At</th>
          <th>Updated At</th>
          <th>Assessment Result Id</th>
          <th>Time Elapsed</th>
          <th>Confidence Level</th>
          <th>Eid</th>
          <th>Src Url</th>
          <th>External User Id</th>
          <th>Keywords</th>
          <th>Objectives</th>
          <th>Correct</th>
          <th>Score</th>
        </tr>
      </thead>
      <tbody>
        <%= render @item_results %>
      </tbody>
    </table>
  </div>
<% end -%>